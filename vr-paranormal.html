<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paranormal VR Vision</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <style>
        body { margin: 0; }
        #instructions {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="instructions">
        Click "Enter VR" for paranormal vision (no boundary setup needed)
    </div>
    
    <a-scene vr-mode-ui="enabled: true">
        <!-- Environment setup -->
        <a-entity id="environment">
            <!-- Create a 360-degree negative vision environment -->
            <a-sphere id="vision-sphere" 
                     radius="5000" 
                     material="shader: flat; side: back; transparent: true; opacity: 0.98"
                     segments-height="64"
                     segments-width="64">
            </a-sphere>
        </a-entity>

        <!-- Camera setup -->
        <a-entity position="0 1.6 0">
            <a-camera id="user-camera" look-controls wasd-controls="enabled: false">
            </a-camera>
        </a-entity>
    </a-scene>

    <script>
        // Setup the paranormal vision effect
        window.addEventListener('load', function() {
            const scene = document.querySelector('a-scene');
            const visionSphere = document.querySelector('#vision-sphere');

            // Start camera when entering VR
            scene.addEventListener('enter-vr', function() {
                navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'environment',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                }).then(function(stream) {
                    // Create video element for camera feed
                    const video = document.createElement('video');
                    video.srcObject = stream;
                    video.autoplay = true;
                    
                    // Create canvas for processing
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = 1280;
                    canvas.height = 720;

                    // Process camera feed with negative effect
                    function processFrame() {
                        if (video.readyState === video.HAVE_ENOUGH_DATA) {
                            ctx.drawImage(video, 0, 0);
                            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                            const data = imageData.data;

                            // Apply negative effect
                            for (let i = 0; i < data.length; i += 4) {
                                data[i] = 255 - data[i];         // Red
                                data[i + 1] = 255 - data[i + 1]; // Green
                                data[i + 2] = 255 - data[i + 2]; // Blue
                                
                                // Enhance green for paranormal effect
                                data[i + 1] = Math.min(255, data[i + 1] + 40);
                            }

                            ctx.putImageData(imageData, 0, 0);

                            // Update the sphere texture
                            visionSphere.setAttribute('material', {
                                src: canvas.toDataURL('image/webp')
                            });
                        }
                        
                        if (scene.is('vr-mode')) {
                            requestAnimationFrame(processFrame);
                        }
                    }

                    video.addEventListener('play', function() {
                        requestAnimationFrame(processFrame);
                    });
                    
                    video.play();
                }).catch(function(err) {
                    console.error('Camera access error:', err);
                });
            });

            // Clean up when exiting VR
            scene.addEventListener('exit-vr', function() {
                const tracks = document.querySelector('video')?.srcObject?.getTracks();
                if (tracks) {
                    tracks.forEach(track => track.stop());
                }
            });
        });
    </script>
</body>
</html> 